{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--The name of my application is Socipoki-->
    <title>{% block pageTitle %} {% endblock %} | Socipoki</title>
    <!-- library css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <!-- Font awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
    <!--style.css-->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>
    <!--navbar-->
    {% include "partials/_navbar.html" with app_name=app_name %}
    <div class="container app_content">
        <!-- the content block of the layout -->
        {% block content %} {% endblock %}
    </div>
    <!--footer-->
    {% include "partials/_footer.html" with app_name=app_name %}
    {% block my_modals %} {%endblock%}
    <!-- jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- library scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    {% block my_scripts %} {%endblock%}
    <script>
        var send_comment_function = (function (e, $formDiv) {
            var $form_url = $formDiv.find("button").data("url");
            var $comment = $formDiv.find("input[name='comment_content']").val();
            $.ajax({
                url: $form_url,
                method: "POST",
                data: { csrfmiddlewaretoken: '{{ csrf_token }}', content: $comment },
                success: function (data) {
                    if (data == "success") {
                        var commentsSection = $formDiv.closest(".comments_section_of_post");
                        var comments = commentsSection.find(".comments_of_post");
                        // append rendered data
                        comments.append(data);
                        // Hide alert
                        comments.find(".no_comments_alert").remove();
                    }
                    else {
                        alert("There is an error.")
                    }
                }
            })
        });

        $(".send_comment_btn").on("click", function (e) {
            var $formDiv = $(this).closest(".send_comment_div");
            send_comment_function(e, $formDiv)
        });
        $(".send_comment_div input").on("keypress", function (e) {
            var $formDiv = $(this).closest(".send_comment_div");
            if (e.which == 13) {
                send_comment_function(e, $formDiv);
            }
        });


        $(".post_action__btn").click(function () {
            var $button = $(this);
            var form_url = $(this).data("url");
            $.ajax({
                url: form_url,
                method: "POST",
                data: { csrfmiddlewaretoken: '{{ csrf_token }}' },
                success: function (data) {
                    // add or remove acted class
                    $button.toggleClass("acted")
                    // add +1 or -1
                    let numberSpan = $button.closest(".post_action__button").find(".post_action__num");
                    let numberOfAction = parseInt(numberSpan.text());
                    if (data == "acted") {
                        numberOfAction += 1
                    }
                    else if (data == "canceled" && numberOfAction != 0) {
                        numberOfAction -= 1
                    }
                    numberSpan.text(numberOfAction)
                }
            });

        });
    </script>

</body>

</html>